version: 2.1

commands:
    composer-install:
        description: "Install dependencies"
        steps:
            - run:
                name: "Execute: composer install"
                command: composer install

    phpcs:
        description: "Execute PHPCS"
        steps:
            - run:
                name: "Execute PHPCS"
                command: vendor/bin/phpcs

    phpstan:
        description: "Execute PHPStan"
        steps:
            - run:
                name: "Execute PHPStan"
                command: vendor/bin/phpstan analyse src --level 7

executors:
    composer:
        docker:
            - image: composer
        working_directory: ~/github-pr-review

jobs:
    code-style-validation:
        executor: composer
        steps:
            - checkout
            - composer-install
            - phpcs
            - phpstan

workflows:
    version: 2.1
    php-check:
        jobs:
            - code-style-validation
